const proofs = JSON.parse(`[{"value":["21232828237346498728306405132038904587277119318103633789089020601655605733667","2453160266458181408654006943385395964042675459632974653789676957627074743741","13248350343223899900836619027978836371082298480843849130310903416461768690760","13961604442439927867745776942444130371496466792520297978440994439498932018645","6717270393641540050353355347818416717030746492564483945074223047612665869002","11998364326848472909221798209200525631282209912420906662758617763086617637507","15976871093695815122859313511828682136908984741342849731459452869564201917625","21119106946381516654780694462651543370483021806867712051632202077358124249753"],"input":["16062868853203428551136397723155233961105157087468929524602345780169497725733","11619548644319271796392429469383986612120836816296259368763456478111135371842"]},{"value":["11706253425769453558898220780476533954585534698948920151025660557444380243744","13440717272526345647519880410551011218486865914320036716651329195354050324564","8009106709465335629280135726608957211524488312569668693500873112392869158428","15047766172944309164211363029709582266555305670254781894782999427679214497809","21237173824721610139446143996229777631037318226632706468625183540356933164144","157736952659158309158414553830393932341200228236149866862845927052826446770","1473306971284246974708737778131386637832975325030325418390964444519853374070","15535768747934218871346737165391103399336223284098183855885395727886412561396"],"input":["16062868853203428551136397723155233961105157087468929524602345780169497725733","11619548644319271796392429469383986612120836816296259368763456478111135371842","8197443125640141868799528728723459163413816196448966983741273338537820375343"]},{"value":["10394650465568362722750572289939628161691874618572889795039884327165365721874","21836133126602076534349210008831228667290465676519878770341506866449513590513","2939632179698429356424967691351669342211099179657068182322762719278306418443","20391675788964608517741563174043737281268759445870444041750979379961333803830","9585756933027896046719621096935865575131405646330104887912576301679604019473","1257196424111730864868441943523875487781879894966018011154422171496915174287","19482956420176710466167727681616889785238605003578861891580067465591309988341","18853483123238762197323533452350837556296601465511837666701061432461221221187"],"input":["16062868853203428551136397723155233961105157087468929524602345780169497725733","8197443125640141868799528728723459163413816196448966983741273338537820375343","7425076751200291262335064577180863500850423796212672584245200387085197008893"]},{"value":["20656483322286405116891476387093837728781860577835749832472499958298870946361","12047233246962656873146032530913693133721489538857951907474987781741529796378","16416087573539225411917475239353236946061253191740938971656170328621881803478","196794064370255225768770185561992014192607848808059801075386094193826857099","11343307684750306786348113359087422644504997355973531891778191903341246123071","17002064868431785780081587622874035079856176564703373751857246479150008886001","15534397927326733371694197032198348414082241127540557039686267123454556692499","8155853140474155219738168945198254673692251893960672710148760474430267539885"],"input":["16062868853203428551136397723155233961105157087468929524602345780169497725733","7425076751200291262335064577180863500850423796212672584245200387085197008893","12022339018649484246348856088328607101145873038936773344982349249688316481155"]},{"value":["7096660538240543559498623204616523611574529675015353405054779837508260278052","9376469847516288139290403760218157785713102247177010459802702813095846368246","74434212910054543414299497278187340442662162498275626081073750489970377302","18731811197323655000711087020037393464427212845491250370202800955025525381241","5393021390914095099233423389871515784366878877050965304717784108271789385343","1620479047899775315534433767571868854940117442414768646110052801900334031904","10795243767676564682776968506751591161795647521775228332308917557405292234509","7563574567668771020728782788266614342060826053844445056508079336209325167188"],"input":["16062868853203428551136397723155233961105157087468929524602345780169497725733","12022339018649484246348856088328607101145873038936773344982349249688316481155","16245682776378617957265611898622330189781507664223141674960140275817213529319"]},{"value":["5180488223805534849862263535309579257128501814024398147868029574980024400693","10553268227348612234284030427398927304028434126799366482023119250489485511340","2936190582805072912074100765118244366842453094003230177840360772942847875109","865717455740201004095153303873332688520818938597752867135852425267563107510","13088315837225285824250803903718654949148071523304690013504571305385328040589","18576551798306311369417559181396329305425339832151537958968566903683502914853","17126096703542447705972401425405197391440603407390533590763468009817496326878","1999111489371462444415904108860163617738548878449669184652493539487373203063"],"input":["16062868853203428551136397723155233961105157087468929524602345780169497725733","16245682776378617957265611898622330189781507664223141674960140275817213529319","20884490461506394723561679470282912431440063519494810600046696701574727319283"]},{"value":["17348554278933895965027294223876028530366188634189436057867780223472497062243","13555709382048931325782293292293146238532369224712219129650952668279940090561","17182515322888079739482105045758800828189293387821253467891775369038091748507","17105171129004859998804782687071081079934533192942269776466825600981140572261","17122756594941050421542498643938149947934277116365653905617183772456107263242","18547203439529120907517230262877690900129694053183890833275545845836255115019","481225195523961944663591270691293227161267929724422782385908031168991356871","16225499587848001387781348570016433461547251789406274421970061862879353016775"],"input":["16062868853203428551136397723155233961105157087468929524602345780169497725733","20884490461506394723561679470282912431440063519494810600046696701574727319283","8572485721489245180727416089109664729410679015293623444649384854114455099486"]},{"value":["2090443297037384222485236271838821833276046606066859132283424497067054606149","2530715698824086845801533084353525012689385865045720664208845150923586955615","19815136075447784767178673885115173260155846240547007688282827560732391638249","14086548480227262866744835288922161685055796308184410180570779553391048378263","14638766240038962581180922149801930578937598300411817350917786855332037014020","3853232358833034527824639926009078083102454541265234327260394990714287676260","15003046496163398649217100696681080104406689564628242491995023035911693301403","1747793398091793724227051316749264628062092450990490519978371850657586565501"],"input":["16062868853203428551136397723155233961105157087468929524602345780169497725733","8572485721489245180727416089109664729410679015293623444649384854114455099486","19884597139445520215987396103775147456863113200653622264374496620242973613640"]},{"value":["16492153835502822564360361935494824473319896867169743174310515232950894377643","17844558082963181194833019198969826286258866659463617684988539139383463446182","7414423381504502392484868743275526671462491886625512953448212875352049533039","17396048952828289957205829147606899476101727671043635343725685665331790877853","15875653856749231132109342875115175590258511151018689812888921494432977787649","9138033107027301622247872321868919244417434092903063748735759499238107656091","9994936167923085026955954934884322165873212671720995801831426322738429330366","1649348210579418928670483443426156864345670190518294827376692463326935212660"],"input":["16062868853203428551136397723155233961105157087468929524602345780169497725733","19884597139445520215987396103775147456863113200653622264374496620242973613640","8460308726022513344647035203782571551073385650794073903073868746162474143376"]},{"value":["15206248377208566691856452720249582270721791001877853427249935736863742861203","8387363847426547024598950895449194379020083424800023657516619646697352260709","7961671528487485678284778611728969082792074580471969262725094821449004566805","5071671288312378890433163269013394612707935995654006113923770730733303542336","5682775987455813689191573392745978795651473329699055253858547784215349852948","9255592533659477784693928646176747180878957268368566642617157324454936540123","14395480239694780810099750807559663978015070948191149950367967826553336717217","8205348554412785037194743105693245108682612916070109710618925363528235067485"],"input":["16062868853203428551136397723155233961105157087468929524602345780169497725733","8460308726022513344647035203782571551073385650794073903073868746162474143376","206810536061509999854756179455597365025169469070620593700739229160009363226"]},{"value":["14798546420266025819603326441961336081411965460651382928472380149542924072749","20367030710227225162787954760725508448790250898693245258936903978535219785432","1052898003957562541406068742608980688681212264156032616032275945207769375926","11106705159643960195142928677574328399012411215525157263414385009065142365559","17116627846018926676529648884974110823876066531580144466015635015352758484914","19772201135922831620378922207811281290613565430864549035081633822073147889986","409194783720570882137234093157200016456756398512936303878097910764072364788","5853300417784172188223787460106606008475073656127467472241496253573400945158"],"input":["16062868853203428551136397723155233961105157087468929524602345780169497725733","206810536061509999854756179455597365025169469070620593700739229160009363226","16991918468748150386653438834047830123960533408392398622568603012062566153293"]},{"value":["2980949973832537185580698989270068713489785334369630510499373397461939400459","13307860252525582001453330208593103517665510356635814999841576349208080626061","19177579424144514526073732528725387346143117693456855903521831631692426588716","19459896723572136663744941302240240538457251294490081273492910429415971498715","17363954218000320076926940688830384483604067489926930050324081971074958799816","9500811871804076328525378558334120580563811562038116281550815644209259613227","10129519234844898704748989477560632064419585930835924424484707526500137371896","6827394770324866126361182479296281072391341468993170232901123013500960398887"],"input":["16062868853203428551136397723155233961105157087468929524602345780169497725733","16991918468748150386653438834047830123960533408392398622568603012062566153293"]}]`)

const InstantiationVerifier = artifacts.require("InstantiationVerifier");
const TransitionVerifier = artifacts.require("TransitionVerifier");
const TerminationVerifier = artifacts.require("TerminationVerifier");

const MockInstantiationVerifier = artifacts.require("MockInstantiationVerifier");

const InstanceManager = artifacts.require("InstanceManager");


contract('InstanceManager', (accounts) => {
  it('instantiation', async () => {
    const instanceManager = await InstanceManager.new(InstantiationVerifier.address, accounts[0], accounts[0]);

    const firstProof = proofs[0];
    const instantiationProof = firstProof.value;
    const model = firstProof.input[0]
    const instance = firstProof.input[1]

    await instanceManager.instantiate(instantiationProof, model, instance);

    const storedInstance = await instanceManager.instancesPerModel(model);
    assert.equal(storedInstance.toString(), instance.toString(), "instance was stored");
  });

  it('termination', async () => {
    const mockInstantiationVerifier = await MockInstantiationVerifier.new();
    const instanceManager = await InstanceManager.new(mockInstantiationVerifier.address, accounts[0], TerminationVerifier.address);

    const lastProof = proofs[proofs.length - 1];
    const terminationProof = lastProof.value;
    const model = lastProof.input[0]
    const instance = lastProof.input[1]


    await instanceManager.instantiate(terminationProof, model, instance); // uses mock
    await instanceManager.terminate(terminationProof, model, instance);

    const storedInstance = await instanceManager.instancesPerModel(model);
    assert.equal(storedInstance.toString(), "0", "instance was stored");
  });

  it('transition', async () => {
    const mockInstantiationVerifier = await MockInstantiationVerifier.new();
    const instanceManager = await InstanceManager.new(mockInstantiationVerifier.address, TransitionVerifier.address, accounts[0]);

    const secondProof = proofs[1];
    const transitionProof = secondProof.value;
    const model = secondProof.input[0]
    const currentInstance = secondProof.input[1]
    const nextInstance = secondProof.input[2]

    await instanceManager.instantiate(transitionProof, model, currentInstance); // uses mock
    await instanceManager.transition(transitionProof, model, currentInstance, nextInstance);

    const storedInstance = await instanceManager.instancesPerModel(model);
    assert.equal(storedInstance.toString(), nextInstance.toString(), "instance was stored");
  });
});
