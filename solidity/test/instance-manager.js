const proofs = JSON.parse(`[{"value":["5132151252630498903990030732290322706773641628104673831644675946108985758663","6359054483908462961517574228932195490133135946625638814294388225564304372761","12700874429549386492410486185977699215970563736712839975169438859847122450381","20762098875848397543481416268977370788214127537472792784118329610934733678651","8134816004362069375878368470010597508169853885581959003275732711143148199438","19113086769750327373536535124763918245160310370010870553970491068087161323003","10520211650624501142683247578555950703699119294826683957924471092369403268249","5727875478360993740017865677104168048811798482295522488433239745161738230973"],"input":["10453721886704132924707654304116756370636326576693294894966698420270915569385","19990694245514952026623184608919123074212994862745321433357012472952975300895"]},{"value":["8284148885450208762953180116049978213857167925565264223226667045817115032059","10701137821664327619557771861955822370413781230612317032562303174811124338212","13149193107826658206108807187237055326677219435827931444636663845092243038828","12771702452209780294449893271335166793260987153714648571143848845360751604229","643069313540314609348123927921386410135489114741088748677987263002848212675","9394189658591037470296829564386855114015199428262409782571464267119487363449","11732850476349600123690984948758329189242069334590819336297525190720124503380","11376976856839549170973764267625825237045037263516754737328129943365753908601"],"input":["10453721886704132924707654304116756370636326576693294894966698420270915569385","19990694245514952026623184608919123074212994862745321433357012472952975300895","20709741544163786349224968810777717413902774300618382568514922238891964056244"]},{"value":["4158104547937689969541009681474470329121628209488231892115579102038402614457","5634105421628312893904886027403452653221160515663264669305643006098444934533","10640930654084595398088287890154618879141367000728172906258654053178192034126","13788693535426564216538608804454509674859826905142451739148414781847168789557","19713019956028584109229565480222749494051254078560078066605361972367260911573","3227911513583318291715629083250762781729022553903485399987847182664199270343","10446998857132423977969206481872003844368217284155411458640544626223615652617","2125185258424798452978134154382869714911815600188338475012387343798329715847"],"input":["10453721886704132924707654304116756370636326576693294894966698420270915569385","20709741544163786349224968810777717413902774300618382568514922238891964056244","21655651494460842637628282776370290481953383255769046633009396360237252272222"]},{"value":["5282360978399807548574400453503537893103255991403835693061996011236392720714","13629011245774374689213719933519756917503444167474281959974199419372240691818","17891739641589528253578332003398216016723016155283193249162207957107770494766","4338178711558449386534581037638363375841548040771084520272190192256287650846","6728373860982557774214178305978048706637990441544002404016536528980424955541","4080587637559533440426620085473794174386430810692135850093079107676036153382","19646254984442353082164879870777388436112490311651686487175094406963872397726","10323696775982669004739278646018188877584664168149433388592478011071428892809"],"input":["10453721886704132924707654304116756370636326576693294894966698420270915569385","21655651494460842637628282776370290481953383255769046633009396360237252272222","13533363796037591863485301244736010831859299116900936044197922264772917513240"]},{"value":["5170459862656020365071494176712874228781491801403171591583468849834264678506","19842198048343029117391193496759431995855112748997191678008595853172301157662","7527347261356871668560295414093592820318270609702802643297363384384509835162","1453488671694836819549100403502848996411156747048572120155416042569121418729","19001149396301751419519738023364857642231513507966109504554092771501113132207","3674881668355623695440430134284582341209409187930943708226488836260123048765","19823695146468204503458391487403680486242208833236895250265870292364817269039","6619067207634357203160773239254322008396494550599521825313631898691892885614"],"input":["10453721886704132924707654304116756370636326576693294894966698420270915569385","13533363796037591863485301244736010831859299116900936044197922264772917513240","3733998655999089707106298710699969901545873364756387938023230232415553489849"]},{"value":["4963025220579661727364107485249186369955203311966160325282135341428642937749","14476812798203537101992834244921871343810840531314250100038016856170685515934","368685483047081098760595935135253623801275615158194698694716267269095725382","2536354174020185097742662869392724072500149254215116923818767759359407052723","10478995734626784263571169862370698581359698837576408182829301995339722787670","1071311696957926248772902723044349182102288798016124929187481823822205084406","9729541276968109253561264680867658830080410377468445129635339516038002805833","14053548961685797340272313703498993016554648089572789730560235066996818761959"],"input":["10453721886704132924707654304116756370636326576693294894966698420270915569385","3733998655999089707106298710699969901545873364756387938023230232415553489849","20558652646366897755679582435437343236555244218319165724975567053148776736793"]},{"value":["4874253131878034218847320569433057566416625259809763976861860741665427898871","3497986661988833403760742549468198430408625748929187261432506623637874719461","8870271924935514325593401358588217736961474414499873505599412745341425204454","18579033190991981059142351459190182164649074422051579996606027213950206402364","13629084695979258370615953379114891343819539513222340486530954730475980973182","20283660888302532726427389880952929106695456570418162192454860672690507750269","9159747280024184775252941933032351842313501670526967108484215812514569862598","13277155100889730813736996277203752039438599902224985565173719754862294700550"],"input":["10453721886704132924707654304116756370636326576693294894966698420270915569385","20558652646366897755679582435437343236555244218319165724975567053148776736793","3506571164346267567191391727241993578213001193081682749121527230251394224502"]},{"value":["11531376936422431545990225339390376553472259925029775358605712670359101818888","9567329744000160119222842948963462586036360618238186455484864262722797993549","5472869766861656702917084570055824223831985481423806046866573188521154516127","7287123843194777977126966456243733930199044944028059015160117512687377156498","3799299260409351647074722545283711398850452901626000945552382251668288950346","19225707575554443538399764468143800326033388305771880196538101236196132861258","13418580216701801033887969458422497918545114258297369470619072517663888492858","371321565855136938906227537745258962725780408657035374057407080818600618706"],"input":["10453721886704132924707654304116756370636326576693294894966698420270915569385","3506571164346267567191391727241993578213001193081682749121527230251394224502","2665444046233776390124959880644449487270897119460778222496310215111447362232"]},{"value":["16460632295269832173314086806768341079461832152779083735155557136876194352248","17119959724575235357265957963950026365456631808582178444346641551184159202483","1187610711701316853657648290955365007759713903468310559890597653730658079127","16103944614017022097945326513767292571851422592003289212457105443492907165691","19798169148068777042054076456839114280874243892573697422481245723079142267542","13634197077195325221320093176023751848185889805486497755097471527098715893437","19314652087859826273736944028004820169333275590726195891119336426028047295334","16319236455365156663868464170797913799843157666320779060683036698532237732932"],"input":["10453721886704132924707654304116756370636326576693294894966698420270915569385","2665444046233776390124959880644449487270897119460778222496310215111447362232","11495771229651326608756621611498254100395527397309012280944395466492142245411"]},{"value":["6704365353165062119060075256779038529053375344378555042607121728327653316051","6136178111743307868669349308522712241405299539576136584435936461526244053266","15866219996856808706508789814945404931896404354092597448340035327925399608077","13182649331747224632940040534729378844226217001044129870999751620624218968229","21815114205966957173624807345078892420125369538671893175053071676649410271440","17982232410740369242882852328182896142329465107421344923795498634912854210277","13582200891833416536658273488741877275091545133888650198395405273371267852809","14362947374103633145747563836609072661113193315986228564763124697352677331949"],"input":["10453721886704132924707654304116756370636326576693294894966698420270915569385","11495771229651326608756621611498254100395527397309012280944395466492142245411","20112387108917103663397587195736863956252508278659153415723105284020744520339"]},{"value":["17105350701235458477856125413858104577439666058905650915457487338291883766844","598694211261695157033375993103189187277868744919492435852343733575941737094","5797841476603535574141993618270008226095273601021728208264857890842430831703","5820704989912160330703882842788023129481916469765557972665035008074212489658","17943745847662016767872788930785928888529363263219353068630396454558045149342","8869502772377401473335946165098616733303189512449318702439722202631452722047","8615840360314822289878867974924054483339742234740204779783536304116249211496","15916930840980256507471538693761699297466913807379935435905249933984927247502"],"input":["10453721886704132924707654304116756370636326576693294894966698420270915569385","20112387108917103663397587195736863956252508278659153415723105284020744520339","18317624743644139556971790745968174505874188946930045125251238392346129917029"]},{"value":["3176481879657802174650744837160524391437856594498892266474041480992309322853","16270803155706822316170177800429106145402384771002349664613647411132278325300","9213307764097605016217156003368878409933594337794442984584369887339223889845","13779700570296166129420151747627080094487413276490650157071714693579574559767","10438534886859014433399746661704120652766652120599395962906368512318091332958","2711560597938486243372640266217239565658107539904735316746248117704010374731","3858284467936400643192816104371189223535176071214946772824923673009541863826","20357086380219188047487632791252420928040493440410981909801348870458728169431"],"input":["10453721886704132924707654304116756370636326576693294894966698420270915569385","18317624743644139556971790745968174505874188946930045125251238392346129917029"]}]`)

const InstantiationVerifier = artifacts.require("InstantiationVerifier");
const TransitionVerifier = artifacts.require("TransitionVerifier");
const TerminationVerifier = artifacts.require("TerminationVerifier");

const MockInstantiationVerifier = artifacts.require("MockInstantiationVerifier");

const InstanceManager = artifacts.require("InstanceManager");


contract('InstanceManager', (accounts) => {
  it('instantiation', async () => {
    const instanceManager = await InstanceManager.new(InstantiationVerifier.address, accounts[0], accounts[0]);

    const firstProof = proofs[0];
    const instantiationProof = firstProof.value;
    const model = firstProof.input[0]
    const instance = firstProof.input[1]

    await instanceManager.instantiate(instantiationProof, model, instance);

    const storedInstance = await instanceManager.instancesPerModel(model);
    assert.equal(storedInstance.toString(), instance.toString(), "instance was stored");
  });

  it('termination', async () => {
    const mockInstantiationVerifier = await MockInstantiationVerifier.new();
    const instanceManager = await InstanceManager.new(mockInstantiationVerifier.address, accounts[0], TerminationVerifier.address);

    const lastProof = proofs[proofs.length - 1];
    const terminationProof = lastProof.value;
    const model = lastProof.input[0]
    const instance = lastProof.input[1]


    await instanceManager.instantiate(terminationProof, model, instance); // uses mock
    await instanceManager.terminate(terminationProof, model, instance);

    const storedInstance = await instanceManager.instancesPerModel(model);
    assert.equal(storedInstance.toString(), "0", "instance was stored");
  });

  it('transition', async () => {
    const mockInstantiationVerifier = await MockInstantiationVerifier.new();
    const instanceManager = await InstanceManager.new(mockInstantiationVerifier.address, TransitionVerifier.address, accounts[0]);

    const secondProof = proofs[1];
    const transitionProof = secondProof.value;
    const model = secondProof.input[0]
    const currentInstance = secondProof.input[1]
    const nextInstance = secondProof.input[2]

    await instanceManager.instantiate(transitionProof, model, currentInstance); // uses mock
    await instanceManager.transition(transitionProof, model, currentInstance, nextInstance);

    const storedInstance = await instanceManager.instancesPerModel(model);
    assert.equal(storedInstance.toString(), nextInstance.toString(), "instance was stored");
  });
});
